<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#09090b">
    <title>EvoRoutine</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&amp;display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css?v=5.0.1">

    <!-- Firebase SDK (v9 - Modular) -->
    <!-- Removed for local version simplicity as per user request -->

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                // navigator.serviceWorker.register('./sw.js');
            });
        }
    </script>
</head>

<body class="theme-dark" style="background-color: #0a0a0f;">

    <!-- VIEW: AUTH -->
    <section id="v-auth" class="view active">
        <div class="center-content">
            <div class="logo-hero">
                <img src="logo.png" alt="EvoRoutine" class="logo-img">
                <h1 data-bind="app.title">EvoRoutine</h1>
                <p data-bind="app.tagline" class="fade-text">Evolve Locally.</p>
            </div>

            <div id="auth-login" class="auth-panel">
                <div id="auth-list" class="scroll-list"></div>
                <button class="btn btn-outline" onclick="App.toggleReg()" data-bind="auth.join">Join the
                    Evolution</button>
            </div>

            <form id="auth-reg" class="auth-panel hidden" onsubmit="event.preventDefault(); App.register()">
                <input type="text" id="reg-name" class="in-lg" data-i18n-ph="auth.name" placeholder="Name" required>
                <input type="email" id="reg-email" class="in-lg" data-i18n-ph="auth.email" placeholder="Email" required>
                <button type="submit" class="btn btn-primary glow" data-bind="auth.start">Start Journey</button>
                <button type="button" class="btn btn-text" onclick="App.toggleReg()" data-bind="auth.rec">Have an
                    account?</button>
            </form>

            <footer style="margin-top:auto; padding-bottom:32px; text-align:center;">
                <p data-bind="auth.credit"
                    style="font-family:'Outfit',sans-serif; font-weight:700; font-size:0.75rem; letter-spacing:1px; color:var(--text-muted); text-transform:uppercase;">
                    Made with ♥️ by emitab
                </p>
            </footer>
        </div>
    </section>

    <!-- VIEW: HUB -->
    <section id="v-hub" class="view">
        <nav class="navbar">
            <div class="nav-usr">
                <div>
                    <h3 id="user-name">User</h3>
                    <small data-bind="hub.hi">Welcome back,</small>
                </div>
            </div>
            <button class="icon-btn" onclick="App.loadSettings()" title="Settings">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6M1 12h6m6 0h6"></path>
                    <path d="m4.93 4.93 4.24 4.24m5.66 5.66 4.24 4.24M4.93 19.07l4.24-4.24m5.66-5.66 4.24-4.24"></path>
                </svg>
            </button>
        </nav>

        <div class="content">
            <div class="stats-row" style="margin-top:20px;">
                <div class="stat-card">
                    <h2 id="sess-count">0</h2>
                    <span data-bind="hub.sess">Sessions</span>
                </div>
                <div class="stat-card">
                    <h2 id="goal-label">Hyp</h2>
                    <span data-bind="lbl.goal">Goal</span>
                </div>
            </div>

            <div class="card settings-card" style="text-align:center; padding:30px;">
                <h3 data-bind="app.tagline" style="margin-bottom:10px;">Evolve Locally.</h3>
                <p id="goal-desc" style="color:var(--text-muted); font-size:0.9rem;">Description</p>
            </div>

            <h4 class="settings-section-title" data-bind="hub.history" style="margin-top: 32px; display: none;"
                id="hist-title">Recent Activity</h4>
            <div id="history-list" class="list-container"></div>
        </div>

        <div class="fab-container">
            <button class="btn btn-primary btn-lg glow" onclick="App.generate()" data-bind="hub.gen">Generate
                Workout</button>
        </div>
    </section>

    <!-- VIEW: SETTINGS -->
    <section id="v-settings" class="view">
        <nav class="navbar">
            <button class="icon-btn" onclick="App.loadHub()">←</button>
            <h3 data-bind="sett.title">Settings</h3>
            <div style="width:24px"></div>
        </nav>
        <div class="content">
            <div class="card">
                <div class="form-row">
                    <label data-bind="sett.lang">Language</label>
                    <select id="sel-lang" class="sel-clean" onchange="App.updateSettings()">
                        <option value="en">English</option>
                        <option value="es">Español</option>
                    </select>
                </div>
                <div class="divider"></div>
                <div class="form-row">
                    <label data-bind="sett.theme">Theme</label>
                    <select id="sel-theme" class="sel-clean" onchange="App.updateSettings()">
                        <option value="dark">Dark</option>
                        <option value="light">Light</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="form-row">
                    <label data-bind="lbl.goal">Goal</label>
                    <select id="sel-goal" class="sel-clean" onchange="App.updateSettings()">
                        <option value="hypertrophy" data-bind="goal.hyp">Hypertrophy</option>
                        <option value="strength" data-bind="goal.str">Strength</option>
                        <option value="endurance" data-bind="goal.end">Endurance</option>
                    </select>
                </div>
                <div class="divider"></div>
                <div class="form-row">
                    <label data-bind="lbl.lvl">Level</label>
                    <select id="sel-lvl" class="sel-clean" onchange="App.updateSettings()">
                        <option value="beginner" data-bind="lvl.beg">Beginner</option>
                        <option value="intermediate" data-bind="lvl.int">Intermediate</option>
                        <option value="advanced" data-bind="lvl.adv">Advanced</option>
                    </select>
                </div>
            </div>

            <h4 class="settings-section-title" data-bind="sett.privacy" style="margin-top: 32px;">Privacy &amp; Data
            </h4>
            <div class="card">
                <button class="settings-btn" onclick="App.exportData()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M7 10l5 5 5-5M12 15V3"></path>
                    </svg>
                    <span data-bind="sett.export">Export My Data</span>
                </button>
                <div class="divider"></div>
                <button class="settings-btn" onclick="App.clearCache()">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                        </path>
                    </svg>
                    <span data-bind="sett.clear">Clear Cache</span>
                </button>
            </div>

            <h4 class="settings-section-title" data-bind="sett.support" style="margin-top: 32px;">Support</h4>
            <div class="card">
                <button class="settings-btn" onclick="Tutorial.reset(); Tutorial.show();">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3M12 17h.01"></path>
                    </svg>
                    <span data-bind="sett.tutorial">Replay Tutorial</span>
                </button>
                <div class="divider"></div>
                <button class="settings-btn" onclick="window.open('https://github.com/emitab/evoroutine', '_blank')">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M12 16v-4M12 8h.01"></path>
                    </svg>
                    <span data-bind="sett.about">About / Help</span>
                </button>
            </div>

            <div class="card" style="margin-top: 16px; text-align: center; padding: 20px;">
                <small style="opacity: 0.6;">EvoRoutine v5.0</small><br>
                <small style="opacity: 0.5; font-size: 0.75rem;">Production Ready</small>
            </div>

            <button class="btn btn-outline" onclick="App.logout()" style="margin-top: 24px;">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"></path>
                </svg>
                <span data-bind="sett.logout">Logout</span>
            </button>

            <button class="btn btn-destructive" onclick="App.deleteAccount()" style="margin-top: 12px;">
                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path
                        d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6">
                    </path>
                </svg>
                <span data-bind="sett.delete">Delete Account</span>
            </button>
        </div>
    </section>

    <!-- VIEW: PLAN -->
    <section id="v-plan" class="view">
        <nav class="navbar">
            <button class="icon-btn" onclick="App.loadHub()">←</button>
            <select id="plan-env" class="sel-clean" style="font-size:1.2rem; font-weight:bold; color:var(--text);"
                onchange="App.regenerate()">
                <option value="gym" data-bind="env.gym">Gym Routine</option>
                <option value="home" data-bind="env.home">Home Routine</option>
            </select>
            <button id="btn-equip-edit" class="icon-btn" onclick="App.openEquipSelector()" style="display:none;">
                <svg width="24" height="24" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                    <path
                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z" />
                </svg>
            </button>
        </nav>
        <div id="plan-list" class="content list-container"></div>
        <button class="btn-square-add" onclick="App.openExSelector('add')">+</button>
        <div class="fab-container">
            <button class="btn btn-primary btn-lg" onclick="App.startSess()" data-bind="auth.start">Start
                Journey</button>
        </div>
    </section>

    <!-- Equipment Selector Overlay -->
    <div id="equip-overlay" class="sheet-overlay">
        <div class="action-sheet" style="height:auto; min-height:40vh;">
            <div class="sheet-header">
                <h3>Equipamiento en Casa</h3>
                <div class="close-sheet" onclick="App.closeEquipSelector()">✕</div>
            </div>
            <div class="sheet-content" style="padding:24px;">
                <p style="color:var(--text-muted); margin-bottom:16px;">¿Qué tienes disponible?</p>

                <label class="equip-option">
                    <input type="checkbox" id="eq-du" value="dumbbells">
                    <div class="eq-label">
                        <b>Mancuernas / Pesas</b>
                        <small>Para ejercicios con carga</small>
                    </div>
                </label>

                <label class="equip-option">
                    <input type="checkbox" id="eq-ba" value="bar">
                    <div class="eq-label">
                        <b>Barra de Dominadas</b>
                        <small>Para espalda y core</small>
                    </div>
                </label>

                <label class="equip-option">
                    <input type="checkbox" id="eq-jr" value="rope">
                    <div class="eq-label">
                        <b>Cuerda de Saltar</b>
                        <small>Para cardio y calentamiento</small>
                    </div>
                </label>

                <button class="btn btn-primary" onclick="App.saveEquipAndGen()"
                    style="margin-top:24px; width:100%">GUARDAR Y GENERAR</button>
            </div>
        </div>
    </div>

    <!-- VIEW: SESSION -->
    <section id="v-sess" class="view">
        <div class="progress-line">
            <div id="sess-bar"></div>
        </div>

        <div class="sess-header">
            <h1 id="ex-name">Exercise</h1>
            <span id="set-badge" class="badge">Set 1/3</span>
        </div>

        <div class="center-content">
            <div class="input-matrix">
                <div class="in-group">
                    <input type="number" id="inp-1" class="in-giant" inputmode="decimal">
                    <label id="lbl-1">KG</label>
                </div>
                <div class="in-group">
                    <input type="number" id="inp-2" class="in-giant" inputmode="decimal">
                    <label id="lbl-2">REPS</label>
                </div>
            </div>

            <div class="rpe-zone">
                <p data-bind="rpe.title">How did that feel?</p>
                <div class="rpe-grid">
                    <button class="rpe-btn" data-v="1" data-bind="rpe.1">Too Easy</button>
                    <button class="rpe-btn" data-v="2" data-bind="rpe.2">Good</button>
                    <button class="rpe-btn" data-v="3" data-bind="rpe.3">Hard</button>
                    <button class="rpe-btn" data-v="4" data-bind="rpe.4">Failure</button>
                </div>
            </div>
        </div>

        <div class="fab-container sess-actions">
            <button class="btn btn-sec"
                onclick="if(App.activeWorkout[App.sess.idx].sets > 1 && App.activeWorkout[App.sess.idx].sets > App.sess.set) { App.activeWorkout[App.sess.idx].sets--; App.renderSet(); }"
                data-bind="sess.sub">- Set</button>
            <button class="btn btn-sec" onclick="App.activeWorkout[App.sess.idx].sets++; App.renderSet()"
                data-bind="sess.add">+ Set</button>
            <button class="btn btn-primary" onclick="App.finishSet()" data-bind="sess.next">NEXT</button>
        </div>
    </section>

    <!-- VIEW: REST -->
    <section id="v-rest" class="view">
        <div class="center-content">
            <div class="rest-controls" style="display:flex; align-items:center; gap:24px; margin-bottom: 24px;">
                <button class="btn-circle-sm" onclick="App.adjustTimer(-10)">-10</button>

                <div class="timer-ring"
                    style="margin:0; width:180px; height:180px; font-size:3.5rem; border-top-color:var(--primary);">
                    <span id="timer-disp">01:30</span>
                </div>

                <button class="btn-circle-sm" onclick="App.adjustTimer(10)">+10</button>
            </div>

            <div style="display:flex; gap:16px;">
                <button class="btn-time-adj" onclick="App.adjustTimer(-30)">-30s</button>
                <button class="btn-time-adj" onclick="App.adjustTimer(30)">+30s</button>
            </div>

            <p style="opacity:0.6; margin-top:24px;" data-bind="sess.recover">RECOVER</p>
        </div>
        <div class="fab-container">
            <button class="btn btn-primary" onclick="App.skipRest()" data-bind="sess.ready">READY</button>
        </div>
    </section>

    <!-- TUTORIAL OVERLAY -->
    <div id="tutorial-overlay" class="tutorial-overlay">
        <div class="tutorial-modal">
            <button class="tutorial-close" onclick="Tutorial.skip()" title="Skip Tutorial">✕</button>
            <div id="tutorial-content"></div>
        </div>
    </div>

    <!-- EXERCISE SELECTOR -->
    <div id="ex-selector-overlay" class="tutorial-overlay">
        <div class="tutorial-modal"
            style="max-height:80vh; display:flex; flex-direction:column; padding:0; overflow:hidden;">
            <div
                style="padding:20px; border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center;">
                <h3 class="tutorial-title" id="ex-sel-title" style="margin:0; font-size:1.2rem;">Select Exercise</h3>
                <button class="tutorial-close" style="position:static;" onclick="App.closeExSelector()">✕</button>
            </div>
            <div id="ex-select-list" style="overflow-y:auto; flex:1;"></div>
        </div>
    </div>

    <!-- ACTION SHEET -->
    <div id="action-sheet-overlay" class="sheet-overlay" onclick="App.closeActionSheet()"></div>
    <div id="action-sheet" class="action-sheet">
        <button class="btn btn-sec" onclick="App.openExSelector('replace')">Replace Exercise</button>
        <button class="btn btn-destructive" onclick="App.removeExercise()">Remove Exercise</button>
        <button class="btn btn-text" onclick="App.closeActionSheet()">Cancel</button>
    </div>

    <!-- CUSTOM EXERCISE MODAL -->
    <div id="custom-ex-overlay" class="tutorial-overlay">
        <div class="tutorial-modal">
            <h3 class="tutorial-title" data-bind="cust.title">New Exercise</h3>
            <p class="tutorial-desc" style="margin-bottom:16px;" data-bind="cust.desc">Create your own exercise.</p>

            <input type="text" id="cust-ex-name" class="in-lg" data-i18n-ph="cust.name"
                placeholder="Name (e.g. Box Jumps)">

            <div style="margin-bottom:20px;">
                <label style="display:block; margin-bottom:8px; color:var(--text-muted); font-size:0.9rem;"
                    data-bind="cust.type">Tracking Type</label>
                <select id="cust-ex-type" class="in-lg" style="margin-bottom:0;">
                    <option value="load" data-bind="cust.t.load">Weights & Reps</option>
                    <option value="body" data-bind="cust.t.body">Reps Only (Bodyweight)</option>
                    <option value="time" data-bind="cust.t.time">Time / Duration</option>
                </select>
            </div>

            <div class="two-btn">
                <button class="btn btn-sec" onclick="App.closeCustomCreator()" data-bind="cust.cancel">Cancel</button>
                <button class="btn btn-primary" onclick="App.saveCustomExercise()"
                    data-bind="cust.create">Create</button>
            </div>
        </div>
    </div>
    <script src="script.js?v=5.0.2"></script>
    <script src="tutorial.js?v=5.0.2"></script>
</body>

</html>